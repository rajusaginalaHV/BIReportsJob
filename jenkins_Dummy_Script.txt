pipeline {
  agent any

  stages {
    stage('Generate payload') {
      steps {
        script {
		  def value1 = ['/Custom/DemoJenkins1', 'Custom_Path']
          def value2 = ['/Custom/Interns-23/DemoJenkins2', 'Interns_Path']
          def value3 = ['/Custom/Raju/DemoJenkins3', 'Raju_new_path']
		  
		  def choices = [value1[1], value2[1], value3[1]]

          // Initialize environment variables
          env.USERNAME = ''
          env.PASSWORD = ''
          env.REPORTNAME = ''
          def selectedValue = ''

          def userInput = input(
            id: 'userInput',
            message: 'Enter the required information',
            parameters: [
              string(defaultValue: 'lisa.jones', description: '', name: 'Please enter the username'),
              password(defaultValue: 'sPP5j^7^', description: '', name: 'Please enter the password'),
              string(defaultValue: 'SampleDM.xdmz', description: '', name: 'Please enter the report to be migrated'),
              choice(choices: choices, description: '', name: 'Please enter the report path')
            ]
          )

          selectedValue = [value1, value2, value3].find { value ->
            value[1] == userInput.SELECTED_VALUE
          }[0]
		  

          // Store user input in environment variables
          env.USERNAME = userInput.USERNAME
          env.PASSWORD = userInput.PASSWORD
          env.REPORTNAME = userInput.REPORTNAME

          // Print the values for verification
          echo "Username: ${env.USERNAME}"
          echo "Password: ${env.PASSWORD}"
          echo "Report Name: ${env.REPORTNAME}"
          echo "Selected Value: ${selectedValue}"

          bat(returnStdout: true, script: "java EncodeToBase64 ${env.REPORTNAME} Payload.xml ${selectedValue} ${env.USERNAME} \"${env.PASSWORD}\"")
        }
      }
    }
    
    stage('Move BI object to catalog server') {
      steps {
        script {
          status_code = bat(returnStdout: true, script: "curl --output output.gzip -w \"%%{http_code}\" --silent --header \"Content-Type:application/xml\" -d @Payload.xml https://fa-erzp-dev12-saasfademo1.ds-fa.oraclepdemos.com:443/xmlpserver/services/v2/CatalogService").trim().split("\n")[1]
          
          echo "HTTP response status code: ${status_code}"
    
          if (status_code != "200") {
            error('URL status different from 200. Exiting script. Please refer to output.gzip')
          }
        }
      }
    }
  }
}
