pipeline {
  agent any

  stages {
    stage('Generate payload') {
      steps {
        script {
		  def value1 = '/Custom/DemoJenkins1'
          def value2 = '/Custom/Interns-23/DemoJenkins2'
          def value3 = '/Custom/Raju/DemoJenkins3'

          // Initialize environment variables
          env.USERNAME = ''
          env.PASSWORD = ''
          env.REPORTNAME = ''
          env.SELECTED_VALUE = ''

          // Prompt user for input
          def userInput = input(
            id: 'userInput',
            message: 'Enter the required information',
            parameters: [
              string(defaultValue: 'lisa.jones', description: 'Please enter the username', name: 'USERNAME'),
              password(defaultValue: 'sPP5j^7^', description: 'Please enter the password', name: 'PASSWORD'),
              string(defaultValue: 'SampleDM.xdmz', description: 'Please enter the report to be migrated', name: 'REPORTNAME'),
              choice(choices: "${value1}\n${value2}\n${value3}", description: 'Select a value', name: 'SELECTED_VALUE')
            ]
          )

          // Store user input in environment variables
          env.USERNAME = userInput.USERNAME
          env.PASSWORD = userInput.PASSWORD
          env.REPORTNAME = userInput.REPORTNAME
          env.SELECTED_VALUE = userInput.SELECTED_VALUE

          // Print the values for verification
          echo "Username: ${env.USERNAME}"
          echo "Password: ${env.PASSWORD}"
          echo "Report Name: ${env.REPORTNAME}"
          echo "Selected Value: ${env.SELECTED_VALUE}"

          bat(returnStdout: true, script: "java EncodeToBase64 ${env.REPORTNAME} Payload.xml ${SELECTED_VALUE} ${env.USERNAME} \"${env.PASSWORD}\"")
        }
      }
    }
    
    stage('Move BI object to catalog server') {
      steps {
        script {
          status_code = bat(returnStdout: true, script: "curl --output output.gzip -w \"%%{http_code}\" --silent --header \"Content-Type:application/xml\" -d @Payload.xml https://fa-erzp-dev12-saasfademo1.ds-fa.oraclepdemos.com:443/xmlpserver/services/v2/CatalogService").trim().split("\n")[1]
          
          echo "HTTP response status code: ${status_code}"
    
          if (status_code != "200") {
            error('URL status different from 200. Exiting script. Please refer to output.gzip')
          }
        }
      }
    }
  }
}
